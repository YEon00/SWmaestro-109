<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>109 robot | Dashboard</title>
    <!-- Tell the browser to be responsive to screen width -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="static/plugins/fontawesome-free/css/all.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">

    <link rel="stylesheet" href="static/css/adminlte.min.css">
    <!-- overlayScrollbars -->
    <link rel="stylesheet" href="static/plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
    <!-- Google Font: Source Sans Pro -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">


    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">

    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
        integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript"
        src="//dapi.kakao.com/v2/maps/sdk.js?appkey=0f3a3a8e297eaddc4e57c1381ad036f3&libraries=services"></script>
    <script src="http://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

</head>

<body class="hold-transition sidebar-mini layout-fixed">

    <div class="wrapper">

        <!-- Navbar -->
        <nav class="main-header navbar navbar-expand navbar-white navbar-light">
            <!-- Left navbar links -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
                </li>
                <li class="nav-item d-none d-sm-inline-block">
                    <a href="/" class="nav-link">Home</a>
                </li>
            </ul>


            <!-- Right navbar links -->
            <ul class="navbar-nav ml-auto">

        </nav>
        <!-- /.navbar -->

        <!-- Main Sidebar Container -->
        <aside class="main-sidebar sidebar-dark-primary elevation-4">
            <!-- Brand Logo -->
            <a href="/" class="brand-link">
                <img src="static/img/109.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3"
                    style="opacity: .8">
                <span class="brand-text font-weight-light">109 manager page</span>
            </a>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Sidebar Menu -->
                <nav class="mt-2">
                    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu"
                        data-accordion="false">
                        <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
                        <li class="nav-item ">
                            <a href="/" class="nav-link">
                                <i class="nav-icon fas fa-tachometer-alt"></i>
                                <p>
                                    Dashboard
                                    <i class="right fas fa-angle-left"></i>
                                </p>
                            </a>
                        </li>
                        <li class="nav-item ">
                            <a href="/contact" class="nav-link">
                                <i class="nav-icon fas fa-book"></i>
                                <p>
                                    User information
                                    <i class="fas fa-angle-left right"></i>
                                </p>
                            </a>
                        </li>
                    </ul>
                </nav>
                <!-- /.sidebar-menu -->
            </div>
            <!-- /.sidebar -->
        </aside>

        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            <div class="content-header">
                <div class="container-fluid">
                    <div class="row mb-2">
                        <div class="col-sm-6">
                            <h1 class="m-0 text-dark">109 center Dashboard </h1>
                        </div><!-- /.col -->
                        <div class="col-sm-6">
                            <ol class="breadcrumb float-sm-right">
                                <li class="breadcrumb-item"><a href="#">Home</a></li>
                                <li class="breadcrumb-item active">Dashboard</li>
                            </ol>
                        </div><!-- /.col -->
                    </div><!-- /.row -->
                </div><!-- /.container-fluid -->
            </div>

            <section class="content">
                <div class="container-fluid">
                    <!-- Map card -->
                    <div class="card " style="background:rgb(210, 210, 211)">
                        <div class="card-header border-0">
                            <h3 class="card-title">
                                <i class="fas fa-map-marker-alt mr-1"></i>
                                USER MAP INFO
                            </h3>
                            <!-- card tools -->
                            <div class="card-tools">
                                <button type="button" class="btn btn-primary btn-sm"
                                    style="background-color: rgb(107, 112, 114) ; border-color:  rgb(63, 74, 78);"
                                    data-card-widget="collapse" data-toggle="tooltip" title="Collapse">
                                    <i class="fas fa-minus "></i>
                                </button>
                            </div>
                            <!-- /.card-tools -->
                        </div>
                        <div class="card-body">
                            <div id="map" style="width:100%;height:400px;">

                            </div>
                        </div>
                        <!-- /.card-body-->
                    </div>
                </div>
            </section>
            <div class="row">
                <div class="col-lg-4">
                    <div class="col-12">
                        <div class="card bg-light">
                            <div class="card-header border-bottom-0">
                                USER INFO
                            </div>

                            <div class="card-body pt-0">

                                <div class="row">
                                    <div class="col-6">
                                        <p class="text-muted "><b>Name : </b> {{data1[0].1}} </p>
                                        <p class="text-muted "><b>Birth : </b>{{data1[0].3}}</p>
                                        <p class="text-muted "><b>Gender : </b> {{data1[0][2]}}</p>

                                    </div>
                                    <div class="col-6">
                                        <ul class="ml-0 mb-0 fa-ul text-muted">
                                            <i class="fas fa-lg fa-building"></i></span> Address: {{data1[0][4]}}<br>
                                            <i class="fas fa-lg fa-phone"></i></span> Phone: {{data1[0][5]}}
                                            </li>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                            </div>

                        </div>
                        <div class=row>
                            <div class="col-6">
                                <div class="info-box mb-3">
                                    <span class="info-box-icon "><img src="static/img/sun.png"></img></span>

                                    <div class="info-box-content">
                                        <span class="info-box-text">현재 온도</span>
                                        <span class="info-box-number">
                                            {{data[0][1]}}
                                            <medium>℃</medium>
                                        </span>
                                    </div>
                                    <!-- /.info-box-content -->
                                </div>
                                <!-- /.info-box -->
                            </div>
                            <div class="col-6">
                                <div class="info-box">
                                    <span class="info-box-icon "><img src="static/img/humidity1.png"></img>
                                    </span>

                                    <div class="info-box-content">
                                        <span class="info-box-text">현재 습도</span>
                                        <span class="info-box-number">
                                            {{data3[0][1]}}
                                            <medium>%</medium>
                                        </span>
                                    </div>
                                    <!-- /.info-box-content -->
                                </div>
                                <!-- /.info-box -->
                            </div>
                            <!-- /.col -->
                            <!-- /.col -->
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <div class="info-box mb-3">
                                    <span class="info-box-icon "><img src="static/img/dog.png"></img></span>
                                    <div class="info-box-content">
                                        <span class="info-box-text">touch</span>
                                        <span class="info-box-number">1</span>
                                    </div>
                                    <!-- /.info-box-content -->
                                </div>
                                <!-- /.info-box -->
                            </div>
                            <div class="col-6">
                                <div class="info-box mb-3">
                                    <span class="info-box-icon ">
                                        <img src="static/img/grandparents.png"></img>
                                    </span>
                                    <div class="info-box-content">

                                        <span class="info-box-text id=">낙상이력</span>
                                        <span class="info-box-number">{{row1.0}}</span>

                                    </div>
                                    <!-- /.info-box-content -->
                                </div>
                                <!-- /.info-box -->
                            </div>
                            <!-- /.col -->
                            <!-- /.col -->
                        </div>
                    </div>
                    <!-- 여기부터-->

                    <!-- fix for small devices only -->
                    <div class="clearfix hidden-md-up"></div>


                </div>
                <div class="col-lg-8">
                    <div class="col-12">
                        <!-- Line chart -->
                        <div class="card card-primary card-outline" style="border-color:rgb(63, 74, 78)">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <i class="far fa-chart-bar"></i>
                                    기상 및 취침
                                </h3>

                                <div class="card-tools">
                                    <button type="button" class="btn btn-tool" data-card-widget="collapse"><i
                                            class="fas fa-minus"></i>
                                    </button>
                                    <button type="button" class="btn btn-tool" data-card-widget="remove"><i
                                            class="fas fa-times"></i></button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="chart">
                                    <canvas id="barChart"
                                        style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                                </div>
                            </div>
                            <!-- /.card-body-->
                        </div>
                        <!-- /.card -->
                    </div>
                    <!-- <div class="card card-primary card-outline" style="border-color:rgb(63, 74, 78)">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="far fa-chart-bar "></i>
                                실시간 활동량
                            </h3>

                            <div class="card-tools">
                                Real time
                                <div class="btn-group" id="realtime" data-toggle="btn-toggle">
                                    <button type="button" class="btn btn-default btn-sm active"
                                        data-toggle="on">On</button>
                                    <button type="button" class="btn btn-default btn-sm" data-toggle="off">Off</button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="interactive" style="height: 300px;"></div>
                        </div>
                        
                    </div> -->


                </div>
            </div>
            <!-- Info boxes -->
            <div class="row">
                <div class="col-lg-6">
                    <div class="col-12">
                        <!-- Line chart -->
                        <div class="card card-primary card-outline" style="border-color:rgb(63, 74, 78)">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <i class="far fa-chart-bar"></i>
                                    활동량 그래프
                                </h3>

                                <div class="card-tools">
                                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <button type="button" class="btn btn-tool" data-card-widget="remove">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="bar-chart" style="height: 300px;"></div>
                            </div>
                            <!-- /.card-body-->
                        </div>
                        <!-- /.card -->

                    </div>
                    <!-- /.card -->
                </div>

                <div class="col-lg-6">

                    <div class="card">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">낙상기록</h3>

                                <div class="card-tools">
                                    <div class="input-group input-group-sm" style="width: 150px;">
                                        <input type="text" name="table_search" class="form-control float-right"
                                            placeholder="Search">

                                        <div class="input-group-append">
                                            <button type="submit" class="btn btn-default"><i
                                                    class="fas fa-search"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- /.card-header -->
                            <div class="card-body table-responsive p-0">
                                <table class="table table-hover text-nowrap">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Date</th>
                                        </tr>
                                    </thead>
                                    {% for n in row %}
                                    <tbody>
                                        <tr>
                                            <td>{{n[0]}}</td>
                                            <td>{{n[1]}}</td>
                                        </tr>

                                    </tbody>
                                    {% endfor %}
                                </table>
                            </div>
                            <!-- /.card-body -->
                        </div>
                        <!-- /.card -->
                    </div>

                    <div class="row">
                        <div class="col-md-1">
                            <div class="card-body">
                                <div class="chart">
                                    <canvas id="areaChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-1">
                            <div class="card-body">
                                <div class="chart">
                                    <canvas id="lineChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /.row -->

                </div>
            </div>
            <!-- Info boxes -->


            <!-- Control Sidebar -->
            <aside class="control-sidebar control-sidebar-dark">
                <!-- Control sidebar content goes here -->
            </aside>
            <!-- /.control-sidebar -->
        </div>
        <!-- ./wrapper -->

        <!-- jQuery -->
        <script src="static/plugins/jquery/jquery.min.js"></script>
        <!-- jQuery UI 1.11.4 -->

        <script src="static/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
        <!-- ChartJS -->
        <script src="static/plugins/chart.js/Chart.min.js"></script>
        <!-- Sparkline -->
        <script src="static/plugins/sparklines/sparkline.js"></script>
        <!-- jQuery Knob Chart -->
        <script src="static/plugins/jquery-knob/jquery.knob.min.js"></script>
        <!-- daterangepicker -->
        <script src="static/plugins/moment/moment.min.js"></script>
        <!-- Tempusdominus Bootstrap 4 -->
        <script src="static/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>
        <!-- Summernote -->
        <script src="static/plugins/summernote/summernote-bs4.min.js"></script>
        <!-- AdminLTE App -->
        <script src="static/js/adminlte.js"></script>
        <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
        <script src="static/js/pages/dashboard.js"></script>
        <!-- AdminLTE for demo purposes -->
        <script src="static/js/demo.js"></script>
        <script src="static/plugins/jquery-ui/jquery-ui.min.js"></script>
        <!-- Bootstrap 4 -->

        <script src="static/js/adminlte.min.js"></script>

        <!-- FLOT CHARTS -->
        <script src="static/plugins/flot/jquery.flot.js"></script>
        <!-- FLOT RESIZE PLUGIN - allows the chart to redraw when the window is resized -->
        <script src="static/plugins/flot-old/jquery.flot.resize.min.js"></script>
        <!-- FLOT PIE PLUGIN - also used to draw donut charts -->
        <script src="static/plugins/flot-old/jquery.flot.pie.min.js"></script>
        <!-- Page script -->

        <audio id="xyz" src="static/img/fall_down.mp3" preload="auto"></audio>
        <script>
            var sleep_time = []
            var sleep_day = []
            {% for rows in sleep %}
            sleep_time.push('{{rows[3]}}');
            sleep_day.push('{{rows[4]}}');
            {% endfor %}
            $(function () {
                var areaChartCanvas = $('#areaChart').get(0).getContext('2d')
                var areaChartData = {
                    labels: sleep_day,
                    datasets: [
                        {
                            label: 'Wake_up',
                            backgroundColor: 'rgba(60,141,188,0.9)',
                            borderColor: 'rgba(60,141,188,0.8)',
                            pointRadius: false,
                            pointColor: '#3b8bba',
                            pointStrokeColor: 'rgba(60,141,188,1)',
                            pointHighlightFill: '#fff',
                            pointHighlightStroke: 'rgba(60,141,188,1)',
                            data: sleep_time
                        },
                        {
                            label: 'Sleeptime',
                            backgroundColor: 'rgba(210, 214, 222, 1)',
                            borderColor: 'rgba(210, 214, 222, 1)',
                            pointRadius: false,
                            pointColor: 'rgba(210, 214, 222, 1)',
                            pointStrokeColor: '#c1c7d1',
                            pointHighlightFill: '#fff',
                            pointHighlightStroke: 'rgba(220,220,220,1)',
                            data: [20, 21, 20, 22.5, 20.5, 21, 21]
                        },
                    ]
                }

                var areaChartOptions = {
                    maintainAspectRatio: false,
                    responsive: true,
                    legend: {
                        display: false
                    },
                    scales: {
                        xAxes: [{
                            gridLines: {
                                display: true,
                            }
                        }],
                        yAxes: [{
                            ticks: {
                                beginAtZero: true,
                                fontSize: 14,
                            },
                            gridLines: {
                                display: false,
                            },

                        }]
                    }
                }

                // This will get the first returned node in the jQuery collection.
                var areaChart = new Chart(areaChartCanvas, {
                    type: 'line',
                    data: areaChartData,
                    options: areaChartOptions
                })

                //-------------
                //- LINE CHART -
                //--------------
                var lineChartCanvas = $('#lineChart').get(0).getContext('2d')
                var lineChartOptions = jQuery.extend(true, {}, areaChartOptions)
                var lineChartData = jQuery.extend(true, {}, areaChartData)
                lineChartData.datasets[0].fill = false;
                lineChartData.datasets[1].fill = false;
                lineChartOptions.datasetFill = false

                var lineChart = new Chart(lineChartCanvas, {
                    type: 'line',
                    data: lineChartData,
                    options: lineChartOptions
                })


                //-------------
                //- BAR CHART -
                //-------------
                var barChartCanvas = $('#barChart').get(0).getContext('2d')
                var barChartData = jQuery.extend(true, {}, areaChartData)
                var temp0 = areaChartData.datasets[0]
                var temp1 = areaChartData.datasets[1]
                barChartData.datasets[0] = temp1
                barChartData.datasets[1] = temp0


                var barChartOptions = {
                    responsive: true,
                    maintainAspectRatio: false,
                    datasetFill: false,
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true,
                                fontSize: 14,
                            }
                        }]
                    }

                }


                var barChart = new Chart(barChartCanvas, {
                    type: 'bar',
                    data: barChartData,
                    options: barChartOptions,

                })

                //---------------------
                //- STACKED BAR CHART -
                //---------------------
                var stackedBarChartCanvas = $('#stackedBarChart').get(0).getContext('2d')
                var stackedBarChartData = jQuery.extend(true, {}, barChartData)

                var stackedBarChartOptions = {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        xAxes: [{
                            stacked: true,
                        }],
                        yAxes: [{
                            stacked: true
                        }]
                    }
                }

                var stackedBarChart = new Chart(stackedBarChartCanvas, {
                    type: 'bar',
                    data: stackedBarChartData,
                    options: stackedBarChartOptions
                })
            })
        </script>
        <script>
            $(function () {

                var bar_data = {
                    data: [[1, 10], [2, 8], [3, 4], [4, 13], [5, 17], [6, 9],
                    [7, 10], [8, 10], [9, 10], [10, 10], [11, 10], [12, 10]],
                    bars: { show: true }
                }
                $.plot('#bar-chart', [bar_data], {
                    grid: {
                        borderWidth: 1,
                        borderColor: '#f3f3f3',
                        tickColor: '#f3f3f3'
                    },
                    series: {
                        bars: {
                            show: true, barWidth: 0.5, align: 'center',
                        },
                    },
                    colors: ['#3c8dbc'],
                    xaxis: {
                        ticks: [[1, 'January'], [2, 'February'], [3, 'March'], [4, 'April'], [5, 'May'], [6, 'June']]
                    }
                })
            });
        </script>

        <script>

            var mapContainer = document.getElementById('map'); // 지도를 표시할 div
            mapOption = {
                center: new kakao.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
                level: 3 // 지도의 확대 레벨
            };

            var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다
            var geocoder = new kakao.maps.services.Geocoder();
            var newAdd = []
            var text = []
            {% for rows in data2 %}
            newAdd.push('{{rows[4]}}');
            text.push('{{rows[1]}}');
            {% endfor %}
            console.log(text[0]);
            newAdd.forEach(function (v, i) {
                geocoder.addressSearch(newAdd[i], function (result, status) {

                    // 정상적으로 검색이 완료됐으면 

                    if (status === kakao.maps.services.Status.OK) {

                        var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                        var imageSrc = 'static/img/green_maker'
                        // 결과값으로 받은 위치를 마커로 표시합니다
                        var marker = new kakao.maps.Marker({
                            map: map,
                            position: coords
                        });
                        marker.id = i+1;
                        var infowindow = new kakao.maps.InfoWindow({
                            content: '<div style="width:150px;text-align:center;padding:6px 0;">' + text[i] + '</div>' + '<div style = text-align:center;padding:6px 0;>' + newAdd[i] + '</div>'
                        });

                        map.setCenter(coords);

                        kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
                        kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
                        kakao.maps.event.addListener(marker, 'click', makeClickListener(marker.id));


                    }
                });
            });
            // 인포윈도우를 표시하는 클로저를 만드는 함수입니다
            function makeOverListener(map, marker, infowindow) {
                return function () {
                    infowindow.open(map, marker);
                    console.log(marker.id)
                };
            }

            // 인포윈도우를 닫는 클로저를 만드는 함수입니다
            function makeOutListener(infowindow) {
                return function () {
                    infowindow.close();
                };
            }

            function makeClickListener(id) {
                return function () {
                    window.location.href = "http://www.109center.com:5000/map?user_id="+id;

                }
            }



        </script>
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
        <script>



        </script>
</body>

</html>